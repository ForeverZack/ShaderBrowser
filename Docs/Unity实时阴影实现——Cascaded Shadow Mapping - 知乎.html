<!DOCTYPE html>
<!-- saved from url=(0037)https://zhuanlan.zhihu.com/p/45673049 -->
<html lang="zh" data-hairline="true" data-theme="light" data-react-helmet="data-theme"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Unity实时阴影实现——Cascaded Shadow Mapping - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"><meta data-react-helmet="true" name="keywords" content="Unity（游戏引擎）,计算机图形学,实时渲染"><meta data-react-helmet="true" name="description" content="前言Unity内置的方向光实时阴影技术是Cascaded Shadow Mapping(简称CSM)。 由于Unity封装的原因，可能并不能满足实际项目实时阴影的需求，但我们可以从Unity开源出来的built-in shaders看出一些实现细节，这些可以…"><meta data-react-helmet="true" property="og:title" content="Unity实时阴影实现——Cascaded Shadow Mapping"><meta data-react-helmet="true" property="og:url" content="https://zhuanlan.zhihu.com/p/45673049"><meta data-react-helmet="true" property="og:description" content="前言Unity内置的方向光实时阴影技术是Cascaded Shadow Mapping(简称CSM)。 由于Unity封装的原因，可能并不能满足实际项目实时阴影的需求，但我们可以从Unity开源出来的built-in shaders看出一些实现细节，这些可以…"><meta data-react-helmet="true" property="og:image" content="https://pic4.zhimg.com/v2-20d9b6be595ab0f8af100c80c7f56c22_b.jpg"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="og:site_name" content="知乎专栏"><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.67c7b278.png"><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.67c7b278.png" sizes="152x152"><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.b3e6278d.png" sizes="120x120"><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.7a750095.png" sizes="76x76"><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.a4a761d4.png" sizes="60x60"><link rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/static/favicon.ico"><link rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/static/search.xml" title="知乎"><link rel="dns-prefetch" href="https://static.zhimg.com/"><link rel="dns-prefetch" href="https://pic1.zhimg.com/"><link rel="dns-prefetch" href="https://pic2.zhimg.com/"><link rel="dns-prefetch" href="https://pic3.zhimg.com/"><link rel="dns-prefetch" href="https://pic4.zhimg.com/"><style>
.u-safeAreaInset-top {
  height: constant(safe-area-inset-top) !important;
  height: env(safe-area-inset-top) !important;
  
}
.u-safeAreaInset-bottom {
  height: constant(safe-area-inset-bottom) !important;
  height: env(safe-area-inset-bottom) !important;
  
}
</style><link href="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/column.app.1aa0ce04aecb4a141299.css" rel="stylesheet"><script type="text/javascript" async="" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/analytics.js" nonce=""></script><script defer="" crossorigin="anonymous" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/init.js" data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;504-ad327c60&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrors&quot;:[&quot;origin message&quot;,&quot;Network request failed&quot;,&quot;Loading chunk&quot;,&quot;这个系统不支持该功能。&quot;,&quot;Can&#39;t find variable: webkit&quot;,&quot;Can&#39;t find variable: $&quot;,&quot;内存不足&quot;,&quot;out of memory&quot;,&quot;DOM Exception 18&quot;,&quot;The operation is insecure&quot;,&quot;[object Event]&quot;,&quot;[object FileError]&quot;,&quot;[object DOMError]&quot;,&quot;[object Object]&quot;,&quot;拒绝访问。&quot;,&quot;Maximum call stack size exceeded&quot;,&quot;UploadError&quot;,&quot;无法 fetch&quot;,&quot;draft-js&quot;,&quot;缺少 JavaScript 对象&quot;,&quot;componentWillEnter&quot;,&quot;componentWillLeave&quot;,&quot;componentWillAppear&quot;,&quot;getInlineStyleAt&quot;,&quot;getCharacterList&quot;],&quot;whitelistUrls&quot;:[&quot;static.zhihu.com&quot;]}"></script><style type="text/css"></style><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><link rel="stylesheet" type="text/css" href="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/column.modals.a64b35ec9dae3d6796a8.css"><script charset="utf-8" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/column.modals.7e57a7799d4419b241c6.js"></script><link rel="stylesheet" type="text/css" href="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/column.richinput.fa4fa8a6733c605ad8f8.css"><script charset="utf-8" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/column.richinput.1a9af3089bc05a961dbb.js"></script></head><body class="WhiteBg-body" data-react-helmet="class"><div id="root"><div class="App"><div class="LoadingBar"></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;&quot;}" data-zop="{&quot;authorName&quot;:&quot;YOung&quot;,&quot;itemId&quot;:45673049,&quot;title&quot;:&quot;Unity实时阴影实现——Cascaded Shadow Mapping&quot;,&quot;type&quot;:&quot;article&quot;}" data-za-detail-view-path-module="PostItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;45673049&quot;}}}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader is-fixed" style="width: 1643.64px; top: 0px; left: 0px;"><div class="ColumnPageHeader-content"><a href="https://www.zhihu.com/" aria-label="知乎"><svg viewBox="0 0 200 91" fill="#0084FF" width="64" height="30"><path d="M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z" fill-rule="evenodd"></path></svg></a><div class="ColumnPageHeader-Button"><button type="button" class="Button ColumnPageHeader-WriteButton Button--blue"><svg class="Zi Zi--EditSurround" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M18.453 7.992l-1.833-1.65.964-.978a1.223 1.223 0 0 1 1.73-.012l.005.006a1.24 1.24 0 0 1 .007 1.748l-.873.886zm-1.178 1.194l-5.578 5.66-1.935.697a.393.393 0 0 1-.504-.504l.697-1.935 5.488-5.567 1.832 1.65zM7.58 5.848l5.654.006-1.539 1.991-3.666.012A1.02 1.02 0 0 0 7 8.868v7.993c0 .558.46 1.01 1.029 1.01l7.941-.01c.568 0 1.03-.453 1.03-1.012v-4.061l2-1.442v6.002c0 1.397-1.2 2.501-2.62 2.501H7.574C6.153 19.85 5 18.717 5 17.32V8.35c0-1.397 1.16-2.502 2.58-2.502z"></path></svg>写文章</button></div></div></div><div class="Sticky--holder" style="position: relative; top: 0px; right: 0px; bottom: 0px; left: 0px; display: block; float: none; margin: 0px; height: 51.9886px;"></div></div></div><img class="TitleImage" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-20d9b6be595ab0f8af100c80c7f56c22_1200x500.jpg" alt="Unity实时阴影实现——Cascaded Shadow Mapping"><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">Unity实时阴影实现——Cascaded Shadow Mapping</h1><div class="Post-Author"><div class="AuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="YOung"><meta itemprop="image" content="https://pic3.zhimg.com/v2-e40ac9d11102ff4fe9936980a729b5be_l.jpg"><meta itemprop="url" content="https://www.zhihu.com/people/chen-yong-59-86"><meta itemprop="zhihu:followerCount"><span class="UserLink AuthorInfo-avatarWrapper"><div class="Popover"><div id="Popover1-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover1-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/chen-yong-59-86"><img class="Avatar Avatar--round AuthorInfo-avatar" width="38" height="38" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-e40ac9d11102ff4fe9936980a729b5be_xs.jpg" srcset="https://pic3.zhimg.com/v2-e40ac9d11102ff4fe9936980a729b5be_l.jpg 2x" alt="YOung"></a></div></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="Popover"><div id="Popover2-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover2-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/chen-yong-59-86">YOung</a></div></div></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="ztext AuthorInfo-badgeText">引擎程序&amp;TA</div></div></div></div></div></div><div><span class="Voters"><button type="button" class="Button Button--plain">99 人<!-- -->赞同了该文章</button></span></div></header><div class="Post-RichTextContainer"><div class="RichText ztext Post-RichText" deep="6"><h2><b>前言</b></h2><p>Unity内置的方向光实时阴影技术是Cascaded Shadow Mapping(简称CSM)。 由于Unity封装的原因，可能并不能满足实际项目实时阴影的需求，但我们可以从Unity开源出来的built-in shaders看出一些实现细节，这些可以作为自定义实现CSM的参考。</p><h2><b>简述</b></h2><blockquote>Perspective aliasing in a shadow map is one of the most difficult problems to overcome. In the technical article, Common Techniques to Improve Shadow Depth Maps, perspective aliasing is described and some approaches to mitigate the problem are identified. In practice, CSMs tend to be the best solution, and are commonly employed in modern games.The basic concept of CSMs is easy to understand. Different areas of the camera frustum require shadow maps with different resolutions. Objects nearest the eye require a higher resolution than do more distant objects. In fact, when the eye moves very close to the geometry, the pixels nearest the eye can require so much resolution that even a 4096 × 4096 shadow map is insufficient.</blockquote><p>基本的Shadow mapping在大场景下存在阴影图精度问题：</p><p>1.主相机整个视锥生成一张阴影图，会导致单个物体占用阴影图的比例太小，读取阴影图时出现采样精度不够（多个像素采样一个图素），产生锯齿。使用尺寸更大的阴影图可以改善这个问题，但会导致内存使用增加。</p><p>2.相机近端和远端物体对阴影图采样精度一样，会导致近端物体采样精度不够，远端物体采样精度浪费。</p><p>大场景方向光动态阴影的解决方案一般是采用CSM技术。CSM通过把相机的视锥体按远近划分为几个级别，处于各个级别下的物体深度信息绘制到各级阴影图中，显示时采样各自对应的阴影图。见下图示意：</p><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic1.zhimg.com/v2-6144c71631f8a0ab8634abbc2b801ff0_b.jpg" data-size="normal" data-rawwidth="654" data-rawheight="326" class="origin_image zh-lightbox-thumb" width="654" data-original="https://pic1.zhimg.com/v2-6144c71631f8a0ab8634abbc2b801ff0_r.jpg"/></noscript><img src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-6144c71631f8a0ab8634abbc2b801ff0_720w.jpg" data-size="normal" data-rawwidth="654" data-rawheight="326" class="origin_image zh-lightbox-thumb lazy" width="654" data-original="https://pic1.zhimg.com/v2-6144c71631f8a0ab8634abbc2b801ff0_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-6144c71631f8a0ab8634abbc2b801ff0_b.jpg" data-lazy-status="ok"><figcaption>2级shadow map采样示意图</figcaption></figure><p><b>实现</b></p><p>下面简述用Unity实现的大致步骤。</p><h2><b>灯光相机视锥</b></h2><p>正交的灯光相机视锥为长方体，为了减少灯光相机的无效绘制，需调整大小为主相机视锥的包围盒。</p><h2><b>获取主相机视锥顶点</b></h2><div class="highlight"><pre><code class="language-c"><span class="kt">void</span> <span class="nf">InitFrustumCorners</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">mainCamera_fcs</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FrustumCorners</span><span class="p">();</span>
    <span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">lightCamera_fcs</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FrustumCorners</span><span class="p">();</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">CalcMainCameraFrustumCorners</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">CalculateFrustumCorners</span><span class="p">(</span><span class="n">new</span> <span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">nearClipPlane</span><span class="p">,</span> <span class="n">Camera</span><span class="p">.</span><span class="n">MonoOrStereoscopicEye</span><span class="p">.</span><span class="n">Mono</span><span class="p">,</span> <span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">TransformPoint</span><span class="p">(</span><span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">CalculateFrustumCorners</span><span class="p">(</span><span class="n">new</span> <span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">farClipPlane</span><span class="p">,</span>  <span class="n">Camera</span><span class="p">.</span><span class="n">MonoOrStereoscopicEye</span><span class="p">.</span><span class="n">Mono</span><span class="p">,</span> <span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">TransformPoint</span><span class="p">(</span><span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div><p>这里用到了Unity的API：CalculateFrustumCorners，可方便获取相机Local的视锥顶点坐标，使用时需转换到World空间下。</p><h2><b>计算灯光相机包围盒</b></h2><p>因为计算得到的包围盒会被直接作为灯光相机的视锥，所以一般包围盒的计算转换到灯光相机空间进行。</p><div class="highlight"><pre><code class="language-csharp"><span class="k">void</span> <span class="n">CalcLightCameraFrustum</span><span class="p">()</span>
<span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">dirLightCamera</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">4</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[i]</span> <span class="p">=</span> <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">InverseTransformPoint</span><span class="p">(</span><span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[i]</span><span class="p">);</span>
        <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[i]</span> <span class="p">=</span> <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">InverseTransformPoint</span><span class="p">(</span><span class="n">mainCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[i]</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">float</span><span class="na">[]</span> <span class="n">xs</span> <span class="p">=</span> <span class="p">{</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[0]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[1]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[2]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[3]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[0]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[1]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[2]</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[3]</span><span class="p">.</span><span class="n">x</span> <span class="p">};</span>

    <span class="kt">float</span><span class="na">[]</span> <span class="n">ys</span> <span class="p">=</span> <span class="p">{</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[0]</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[1]</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[2]</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[3]</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[0]</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[1]</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[2]</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[3]</span><span class="p">.</span><span class="n">y</span> <span class="p">};</span>

    <span class="kt">float</span><span class="na">[]</span> <span class="n">zs</span> <span class="p">=</span> <span class="p">{</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[0]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[1]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[2]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[3]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span>
                    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[0]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[1]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[2]</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[3]</span><span class="p">.</span><span class="n">z</span> <span class="p">};</span>

    <span class="kt">float</span> <span class="n">minX</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Min</span><span class="p">(</span><span class="n">xs</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">maxX</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">xs</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">minY</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Min</span><span class="p">(</span><span class="n">ys</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">maxY</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">ys</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">minZ</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Min</span><span class="p">(</span><span class="n">zs</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">maxZ</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">zs</span><span class="p">);</span>

    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[0]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">minY</span><span class="p">,</span> <span class="n">minZ</span><span class="p">);</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[1]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span> <span class="n">minY</span><span class="p">,</span> <span class="n">minZ</span><span class="p">);</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[2]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span> <span class="n">maxY</span><span class="p">,</span> <span class="n">minZ</span><span class="p">);</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[3]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">maxY</span><span class="p">,</span> <span class="n">minZ</span><span class="p">);</span>

    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[0]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">minY</span><span class="p">,</span> <span class="n">maxZ</span><span class="p">);</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[1]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span> <span class="n">minY</span><span class="p">,</span> <span class="n">maxZ</span><span class="p">);</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[2]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span> <span class="n">maxY</span><span class="p">,</span> <span class="n">maxZ</span><span class="p">);</span>
    <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">farCorners</span><span class="na">[3]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">maxY</span><span class="p">,</span> <span class="n">maxZ</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div><p>得到的包围盒用线框绘制出来见下图：</p><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic4.zhimg.com/v2-994fe426be2fe19ff823af04ce98f33b_b.jpg" data-caption="" data-size="normal" data-rawwidth="451" data-rawheight="406" class="origin_image zh-lightbox-thumb" width="451" data-original="https://pic4.zhimg.com/v2-994fe426be2fe19ff823af04ce98f33b_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;451&#39; height=&#39;406&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="451" data-rawheight="406" class="origin_image zh-lightbox-thumb lazy" width="451" data-original="https://pic4.zhimg.com/v2-994fe426be2fe19ff823af04ce98f33b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-994fe426be2fe19ff823af04ce98f33b_b.jpg"></figure><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><p>上图的灰色线框表示主相机视锥，绿色线框表示包围盒，红色线框表示近平面。</p><h2><b>构造灯光相机</b></h2><div class="highlight"><pre><code class="language-csharp"><span class="n">Vector3</span> <span class="n">pos</span> <span class="p">=</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[0]</span> <span class="p">+</span> <span class="p">(</span><span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[2]</span> <span class="p">-</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[0]</span><span class="p">)</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
        <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">TransformPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
        <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span> <span class="p">=</span> <span class="n">dirLight</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">;</span>
        <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">nearClipPlane</span> <span class="p">=</span> <span class="n">minZ</span><span class="p">;</span>
        <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">farClipPlane</span> <span class="p">=</span> <span class="n">maxZ</span><span class="p">;</span>
        <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">aspect</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Magnitude</span><span class="p">(</span><span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[0]</span> <span class="p">-</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[1]</span><span class="p">)</span> <span class="p">/</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Magnitude</span><span class="p">(</span><span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[1]</span> <span class="p">-</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[2]</span><span class="p">);</span>
        <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">orthographicSize</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Magnitude</span><span class="p">(</span><span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[1]</span> <span class="p">-</span> <span class="n">lightCamera_fcs</span><span class="p">.</span><span class="n">nearCorners</span><span class="na">[2]</span><span class="p">)</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
</code></pre></div><p>上述代码设置灯光相机的视锥参数(也是灯光相机的投影矩阵)nearClipPlane，farClipPlane，aspect和orthographicSize。</p><p>灯光相机的位置和朝向也需要设置，其中位置为近平面的中点，计算方法见下图：</p><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic1.zhimg.com/v2-f8df1b238e9b0b8d48204424d79e19c8_b.jpg" data-caption="" data-size="normal" data-rawwidth="427" data-rawheight="393" class="origin_image zh-lightbox-thumb" width="427" data-original="https://pic1.zhimg.com/v2-f8df1b238e9b0b8d48204424d79e19c8_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;427&#39; height=&#39;393&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="427" data-rawheight="393" class="origin_image zh-lightbox-thumb lazy" width="427" data-original="https://pic1.zhimg.com/v2-f8df1b238e9b0b8d48204424d79e19c8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-f8df1b238e9b0b8d48204424d79e19c8_b.jpg"></figure><p><img src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/equation" alt="[公式]" eeimg="1" data-formula="\vec{OP} = \vec{OA} + \vec{AP} = \vec{OA} + \frac{\vec{AC}}{2}"> </p><h2><b>主相机视锥分割</b></h2><p>Unity的QualitySettings里提供了对相机视锥的分割设置，见下图：</p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic4.zhimg.com/v2-a4ecc1af2e26dc575539a7804a5dfa2b_b.jpg" data-size="normal" data-rawwidth="627" data-rawheight="70" class="origin_image zh-lightbox-thumb" width="627" data-original="https://pic4.zhimg.com/v2-a4ecc1af2e26dc575539a7804a5dfa2b_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;627&#39; height=&#39;70&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="627" data-rawheight="70" class="origin_image zh-lightbox-thumb lazy" width="627" data-original="https://pic4.zhimg.com/v2-a4ecc1af2e26dc575539a7804a5dfa2b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-a4ecc1af2e26dc575539a7804a5dfa2b_b.jpg"><figcaption>Unity4级视锥分割参数</figcaption></figure><p>UnityShaderVariables.cginc用以下变量保存分割参数：</p><div class="highlight"><pre><code class="language-csharp">    <span class="n">float4</span> <span class="n">_LightSplitsNear</span><span class="p">;</span>
    <span class="n">float4</span> <span class="n">_LightSplitsFar</span><span class="p">;</span>
</code></pre></div><p>这里类似实现：</p><div class="highlight"><pre><code class="language-csharp">    <span class="kt">float</span><span class="na">[]</span> <span class="n">_LightSplitsNear</span><span class="p">;</span>
    <span class="kt">float</span><span class="na">[]</span> <span class="n">_LightSplitsFar</span><span class="p">;</span>

    <span class="p">...</span>

    <span class="kt">float</span><span class="na">[]</span> <span class="n">nears</span> <span class="p">=</span> <span class="p">{</span> <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.067f</span> <span class="p">+</span> <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.133f</span> <span class="p">+</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.067f</span> <span class="p">+</span> <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.267f</span> <span class="p">+</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.133f</span> <span class="p">+</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.067f</span> <span class="p">+</span> <span class="n">near</span> <span class="p">};</span>
    <span class="kt">float</span><span class="na">[]</span> <span class="n">fars</span> <span class="p">=</span> <span class="p">{</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.067f</span> <span class="p">+</span> <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.133f</span> <span class="p">+</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.067f</span> <span class="p">+</span> <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.267f</span> <span class="p">+</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.133f</span> <span class="p">+</span> <span class="n">far</span> <span class="p">*</span> <span class="m">0.067f</span> <span class="p">+</span> <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="p">};</span>

    <span class="n">_LightSplitsNear</span> <span class="p">=</span> <span class="n">nears</span><span class="p">;</span>
    <span class="n">_LightSplitsFar</span> <span class="p">=</span> <span class="n">fars</span><span class="p">;</span>

    <span class="p">...</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">4</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="c1">//计算主相机分割视锥
</span><span class="c1"></span>        <span class="p">...</span>
        <span class="c1">//计算分割视锥的灯光相机包围盒
</span><span class="c1"></span>        <span class="p">...</span>
    <span class="p">}</span>
</code></pre></div><p>得到的分割包围盒见下图：</p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic2.zhimg.com/v2-aa29ed68a52a5491c8b98bcfa80d491d_b.jpg" data-size="normal" data-rawwidth="650" data-rawheight="581" class="origin_image zh-lightbox-thumb" width="650" data-original="https://pic2.zhimg.com/v2-aa29ed68a52a5491c8b98bcfa80d491d_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;650&#39; height=&#39;581&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="650" data-rawheight="581" class="origin_image zh-lightbox-thumb lazy" width="650" data-original="https://pic2.zhimg.com/v2-aa29ed68a52a5491c8b98bcfa80d491d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-aa29ed68a52a5491c8b98bcfa80d491d_b.jpg"><figcaption>Unity4级视锥分割俯视图</figcaption></figure><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><h2><b>级联阴影图生成</b></h2><p>级联灯光相机通过设置各个级别的视锥依次绘制便得到各自对应阴影图：</p><div class="highlight"><pre><code class="language-csharp"><span class="n">List</span><span class="p">&lt;</span><span class="n">Matrix4x4</span><span class="p">&gt;</span> <span class="n">world2ShadowMats</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Matrix4x4</span><span class="p">&gt;(</span><span class="m">4</span><span class="p">);</span>
<span class="n">RenderTexture</span><span class="na">[]</span> <span class="n">depthTextures</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RenderTexture</span><span class="na">[4]</span><span class="p">;</span>

<span class="p">...</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">4</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="n">depthTextures</span><span class="na">[i]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RenderTexture</span><span class="p">(</span><span class="m">1024</span><span class="p">,</span> <span class="m">1024</span><span class="p">,</span> <span class="m">24</span><span class="p">,</span> <span class="n">rtFormat</span><span class="p">);</span>
    <span class="n">Shader</span><span class="p">.</span><span class="n">SetGlobalTexture</span><span class="p">(</span><span class="s">"_gShadowMapTexture"</span> <span class="p">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">depthTextures</span><span class="na">[i]</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="n">world2ShadowMats</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">4</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="n">ConstructLightCameraSplits</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">targetTexture</span> <span class="p">=</span> <span class="n">depthTextures</span><span class="na">[i]</span><span class="p">;</span>
    <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">RenderWithShader</span><span class="p">(</span><span class="n">shadowCaster</span><span class="p">,</span> <span class="s">""</span><span class="p">);</span>
    <span class="n">projectionMatrix</span> <span class="p">=</span> <span class="n">GL</span><span class="p">.</span><span class="n">GetGPUProjectionMatrix</span><span class="p">(</span><span class="n">dirLightCamera</span><span class="p">.</span><span class="n">projectionMatrix</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="n">world2ShadowMats</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">projectionMatrix</span> <span class="p">*</span> <span class="n">dirLightCamera</span><span class="p">.</span><span class="n">worldToCameraMatrix</span><span class="p">);</span>
<span class="p">}</span>            

<span class="n">Shader</span><span class="p">.</span><span class="n">SetGlobalMatrixArray</span><span class="p">(</span><span class="s">"_gWorld2Shadow"</span><span class="p">,</span> <span class="n">world2ShadowMats</span><span class="p">);</span>
</code></pre></div><p>Unity底层实现是用一张2x2阴影图集来保存4级阴影图。由于我使用的Unity版本原因，这里使用4张单独的rt来分别保存。</p><p><i>Unity2017新版本里已经加入对RenderTexture分区域更新的特性，这样便也可以在上层实现类似底层的级联阴影图集。</i></p><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic4.zhimg.com/v2-ed56a447f18cc31f09d185dba06b1b43_b.jpg" data-size="normal" data-rawwidth="584" data-rawheight="581" class="origin_image zh-lightbox-thumb" width="584" data-original="https://pic4.zhimg.com/v2-ed56a447f18cc31f09d185dba06b1b43_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;584&#39; height=&#39;581&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="584" data-rawheight="581" class="origin_image zh-lightbox-thumb lazy" width="584" data-original="https://pic4.zhimg.com/v2-ed56a447f18cc31f09d185dba06b1b43_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-ed56a447f18cc31f09d185dba06b1b43_b.jpg"><figcaption>4级级联阴影图</figcaption></figure><h2><b>级联阴影图采样</b></h2><p>UnityShaderVariables.cginc用以下变量保存分割后的世界坐标到光源空间投影坐标的矩阵变换：</p><div class="highlight"><pre><code class="language-csharp"><span class="n">float4x4</span> <span class="n">unity_WorldToShadow</span><span class="na">[4]</span><span class="p">;</span>
</code></pre></div><p>配合视锥分割参数和片段深度可获取对应级联索引，Internal-ScreenSpaceShadows.cginc：</p><div class="highlight"><pre><code class="language-text">inline fixed4 getCascadeWeights(float3 wpos, float z)
{
    fixed4 zNear = float4( z &gt;= _LightSplitsNear );
    fixed4 zFar = float4( z &lt; _LightSplitsFar );
    fixed4 weights = zNear * zFar;

    return weights;
}</code></pre></div><p>上面函数传进来的片段世界坐标wpos并没有用：（，返回值4个分量均为布尔值，比如z值0.4得到的返回值为fixed4（0,0,1,0)，表示对应3级的矩阵变换和阴影图。</p><p>这里类似实现：</p><div class="highlight"><pre><code class="language-csharp"><span class="n">uniform</span> <span class="n">float4x4</span> <span class="n">_gWorld2Shadow</span><span class="na">[4]</span><span class="p">;</span>

<span class="p">...</span>

<span class="n">float4</span> <span class="n">SampleShadowTexture</span><span class="p">(</span><span class="n">float4</span> <span class="n">wPos</span><span class="p">,</span> <span class="n">fixed4</span> <span class="n">cascadeWeights</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">float4</span> <span class="n">shadowCoord0</span> <span class="p">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">_gWorld2Shadow</span><span class="na">[0]</span><span class="p">,</span> <span class="n">wPos</span><span class="p">);</span>
    <span class="n">float4</span> <span class="n">shadowCoord1</span> <span class="p">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">_gWorld2Shadow</span><span class="na">[1]</span><span class="p">,</span> <span class="n">wPos</span><span class="p">);</span>
    <span class="n">float4</span> <span class="n">shadowCoord2</span> <span class="p">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">_gWorld2Shadow</span><span class="na">[2]</span><span class="p">,</span> <span class="n">wPos</span><span class="p">);</span>
    <span class="n">float4</span> <span class="n">shadowCoord3</span> <span class="p">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">_gWorld2Shadow</span><span class="na">[3]</span><span class="p">,</span> <span class="n">wPos</span><span class="p">);</span>

    <span class="n">shadowCoord0</span><span class="p">.</span><span class="n">xy</span> <span class="p">/=</span> <span class="n">shadowCoord0</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
    <span class="n">shadowCoord1</span><span class="p">.</span><span class="n">xy</span> <span class="p">/=</span> <span class="n">shadowCoord1</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
    <span class="n">shadowCoord2</span><span class="p">.</span><span class="n">xy</span> <span class="p">/=</span> <span class="n">shadowCoord2</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
    <span class="n">shadowCoord3</span><span class="p">.</span><span class="n">xy</span> <span class="p">/=</span> <span class="n">shadowCoord3</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>

    <span class="n">shadowCoord0</span><span class="p">.</span><span class="n">xy</span> <span class="p">=</span> <span class="n">shadowCoord0</span><span class="p">.</span><span class="n">xy</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span>
    <span class="n">shadowCoord1</span><span class="p">.</span><span class="n">xy</span> <span class="p">=</span> <span class="n">shadowCoord1</span><span class="p">.</span><span class="n">xy</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span>
    <span class="n">shadowCoord2</span><span class="p">.</span><span class="n">xy</span> <span class="p">=</span> <span class="n">shadowCoord2</span><span class="p">.</span><span class="n">xy</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span>
    <span class="n">shadowCoord3</span><span class="p">.</span><span class="n">xy</span> <span class="p">=</span> <span class="n">shadowCoord3</span><span class="p">.</span><span class="n">xy</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span>

    <span class="n">float4</span> <span class="n">sampleDepth0</span> <span class="p">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_gShadowMapTexture0</span><span class="p">,</span> <span class="n">shadowCoord0</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">float4</span> <span class="n">sampleDepth1</span> <span class="p">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_gShadowMapTexture1</span><span class="p">,</span> <span class="n">shadowCoord1</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">float4</span> <span class="n">sampleDepth2</span> <span class="p">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_gShadowMapTexture2</span><span class="p">,</span> <span class="n">shadowCoord2</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">float4</span> <span class="n">sampleDepth3</span> <span class="p">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_gShadowMapTexture3</span><span class="p">,</span> <span class="n">shadowCoord3</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">depth0</span> <span class="p">=</span> <span class="n">shadowCoord0</span><span class="p">.</span><span class="n">z</span> <span class="p">/</span> <span class="n">shadowCoord0</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">depth1</span> <span class="p">=</span> <span class="n">shadowCoord1</span><span class="p">.</span><span class="n">z</span> <span class="p">/</span> <span class="n">shadowCoord1</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">depth2</span> <span class="p">=</span> <span class="n">shadowCoord2</span><span class="p">.</span><span class="n">z</span> <span class="p">/</span> <span class="n">shadowCoord2</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">depth3</span> <span class="p">=</span> <span class="n">shadowCoord3</span><span class="p">.</span><span class="n">z</span> <span class="p">/</span> <span class="n">shadowCoord3</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>

    <span class="cp">#if defined (SHADER_TARGET_GLSL)
</span><span class="cp"></span>        <span class="n">depth0</span> <span class="p">=</span> <span class="n">depth0</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span> <span class="c1">//(-1, 1)--&gt;(0, 1)
</span><span class="c1"></span>        <span class="n">depth1</span> <span class="p">=</span> <span class="n">depth1</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span>
        <span class="n">depth2</span> <span class="p">=</span> <span class="n">depth2</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span>
        <span class="n">depth3</span> <span class="p">=</span> <span class="n">depth3</span><span class="p">*</span><span class="m">0.5</span> <span class="p">+</span> <span class="m">0.5</span><span class="p">;</span>
    <span class="cp">#elif defined (UNITY_REVERSED_Z)
</span><span class="cp"></span>        <span class="n">depth0</span> <span class="p">=</span> <span class="m">1</span> <span class="p">-</span> <span class="n">depth0</span><span class="p">;</span>       <span class="c1">//(1, 0)--&gt;(0, 1)
</span><span class="c1"></span>        <span class="n">depth1</span> <span class="p">=</span> <span class="m">1</span> <span class="p">-</span> <span class="n">depth1</span><span class="p">;</span>
        <span class="n">depth2</span> <span class="p">=</span> <span class="m">1</span> <span class="p">-</span> <span class="n">depth2</span><span class="p">;</span>
        <span class="n">depth3</span> <span class="p">=</span> <span class="m">1</span> <span class="p">-</span> <span class="n">depth3</span><span class="p">;</span>
    <span class="cp">#endif
</span><span class="cp"></span>
    <span class="kt">float</span> <span class="n">shadow0</span> <span class="p">=</span> <span class="n">sampleDepth0</span> <span class="p">&lt;</span> <span class="n">depth0</span> <span class="p">?</span> <span class="n">_gShadowStrength</span> <span class="p">:</span> <span class="m">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">shadow1</span> <span class="p">=</span> <span class="n">sampleDepth1</span> <span class="p">&lt;</span> <span class="n">depth1</span> <span class="p">?</span> <span class="n">_gShadowStrength</span> <span class="p">:</span> <span class="m">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">shadow2</span> <span class="p">=</span> <span class="n">sampleDepth2</span> <span class="p">&lt;</span> <span class="n">depth2</span> <span class="p">?</span> <span class="n">_gShadowStrength</span> <span class="p">:</span> <span class="m">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">shadow3</span> <span class="p">=</span> <span class="n">sampleDepth3</span> <span class="p">&lt;</span> <span class="n">depth3</span> <span class="p">?</span> <span class="n">_gShadowStrength</span> <span class="p">:</span> <span class="m">1</span><span class="p">;</span>

    <span class="c1">//return col0;
</span><span class="c1"></span>    <span class="kt">float</span> <span class="n">shadow</span> <span class="p">=</span> <span class="n">shadow0</span><span class="p">*</span><span class="n">cascadeWeights</span><span class="na">[0]</span> <span class="p">+</span> <span class="n">shadow1</span><span class="p">*</span><span class="n">cascadeWeights</span><span class="na">[1]</span> <span class="p">+</span> <span class="n">shadow2</span><span class="p">*</span><span class="n">cascadeWeights</span><span class="na">[2]</span> <span class="p">+</span> <span class="n">shadow3</span><span class="p">*</span><span class="n">cascadeWeights</span><span class="na">[3]</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">shadow</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2><b>Shadow Cascadeds查看模式</b></h2><p>Unity的Scene模式下有一个Shadow Cascadeds查看模式，可以方便查看整个场景的级联阴影图分布。</p><p>这种效果简单实现可以把级联级别作为颜色参数叠加到阴影颜色上即可：</p><div class="highlight"><pre><code class="language-csharp"><span class="k">return</span> <span class="n">shadow</span><span class="p">*</span><span class="n">cascadeWeights</span><span class="p">;</span>
</code></pre></div><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic3.zhimg.com/v2-78e050d7791d92222637998e469c7e2a_b.jpg" data-size="normal" data-rawwidth="1143" data-rawheight="597" class="origin_image zh-lightbox-thumb" width="1143" data-original="https://pic3.zhimg.com/v2-78e050d7791d92222637998e469c7e2a_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1143&#39; height=&#39;597&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1143" data-rawheight="597" class="origin_image zh-lightbox-thumb lazy" width="1143" data-original="https://pic3.zhimg.com/v2-78e050d7791d92222637998e469c7e2a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-78e050d7791d92222637998e469c7e2a_b.jpg"><figcaption>Unity自带和自实现的Shadow Cascadeds查看模式对比</figcaption></figure><h2><b>结论</b></h2><p>CSM能有效解决透视相机下的阴影锯齿问题，基本的SM通过增加阴影图大小可改善阴影质量，但不能根本解决问题。</p><p>下面展示了同场景下SM和CSM的阴影质量对比，明显可看出CSM使用相同大小的阴影图(2048x2048 = 4x1024x1024)，但获得了好得多的阴影质量。</p><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><figure data-size="normal"><noscript data-filtered="filtered"><img src="https://pic3.zhimg.com/v2-08176c44d24379c2c5baf68dd177cc6a_b.jpg" data-size="normal" data-rawwidth="1150" data-rawheight="611" class="origin_image zh-lightbox-thumb" width="1150" data-original="https://pic3.zhimg.com/v2-08176c44d24379c2c5baf68dd177cc6a_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1150&#39; height=&#39;611&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1150" data-rawheight="611" class="origin_image zh-lightbox-thumb lazy" width="1150" data-original="https://pic3.zhimg.com/v2-08176c44d24379c2c5baf68dd177cc6a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-08176c44d24379c2c5baf68dd177cc6a_b.jpg"><figcaption>单张2048的阴影贴图和4张1024级联阴影贴图阴影效果对比</figcaption></figure><p>当然，CSM存在重复绘制和多次采样的问题，这也是Unity的CSM方案对mobile平台缺省为1个cascade的原因。</p><p class="ztext-empty-paragraph"><br data-filtered="filtered"></p><p>完整代码见：</p><a target="_blank" href="https://link.zhihu.com/?target=https%3A//github.com/chenyong2github/CascadedShadowMapping" data-draft-node="block" data-draft-type="link-card" data-image="https://pic3.zhimg.com/v2-06ce3400e350c07c493f688d7b2326e6_ipico.jpg" data-image-width="184" data-image-height="184" class="LinkCard LinkCard--hasImage"><span class="LinkCard-backdrop" style="background-image:url(https://pic3.zhimg.com/v2-06ce3400e350c07c493f688d7b2326e6_ipico.jpg)"></span><span class="LinkCard-content"><span class="LinkCard-text"><span class="LinkCard-title" data-text="true">chenyong2github/CascadedShadowMapping</span><span class="LinkCard-meta"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--InsertLink" fill="currentColor" viewBox="0 0 24 24" width="17" height="17"><path d="M6.77 17.23c-.905-.904-.94-2.333-.08-3.193l3.059-3.06-1.192-1.19-3.059 3.058c-1.489 1.489-1.427 3.954.138 5.519s4.03 1.627 5.519.138l3.059-3.059-1.192-1.192-3.059 3.06c-.86.86-2.289.824-3.193-.08zm3.016-8.673l1.192 1.192 3.059-3.06c.86-.86 2.289-.824 3.193.08.905.905.94 2.334.08 3.194l-3.059 3.06 1.192 1.19 3.059-3.058c1.489-1.489 1.427-3.954-.138-5.519s-4.03-1.627-5.519-.138L9.786 8.557zm-1.023 6.68c.33.33.863.343 1.177.029l5.34-5.34c.314-.314.3-.846-.03-1.176-.33-.33-.862-.344-1.176-.03l-5.34 5.34c-.314.314-.3.846.03 1.177z" fill-rule="evenodd"></path></svg></span>github.com</span></span><span class="LinkCard-imageCell"><img class="LinkCard-image LinkCard-image--square" alt="图标" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-06ce3400e350c07c493f688d7b2326e6_ipico.jpg"></span></span></a><p>参考文献：</p><p><a href="https://link.zhihu.com/?target=https%3A//msdn.microsoft.com/en-us/library/windows/desktop/ee416307%28v%3Dvs.85%29.aspx" class=" wrap external" target="_blank" rel="nofollow noreferrer">Cascaded Shadow Maps</a></p><p><a href="https://link.zhihu.com/?target=http%3A//ogldev.atspace.co.uk/www/tutorial49/tutorial49.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">Cascaded Shadow Mapping</a></p><p></p></div></div><div class="ContentItem-time">编辑于 2018-11-15</div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19568806&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19568806" target="_blank"><div class="Popover"><div id="Popover3-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover3-content">Unity（游戏引擎）</div></div></a></span></div><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19613730&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19613730" target="_blank"><div class="Popover"><div id="Popover4-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover4-content">计算机图形学</div></div></a></span></div><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;20140337&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/20140337" target="_blank"><div class="Popover"><div id="Popover5-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover5-content">实时渲染</div></div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-fixed is-bottom" style="width: 690px; bottom: 0px; left: 476.818px;"><div class="ContentItem-actions" data-za-detail-view-path-module="BottomBar" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;45673049&quot;}}}"><span><button aria-label="赞同 99 " type="button" class="Button VoteButton VoteButton--up"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor" viewBox="0 0 24 24" width="10" height="10"><path d="M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z" fill-rule="evenodd"></path></svg></span>赞同 99</button><button aria-label="反对" type="button" class="Button VoteButton VoteButton--down"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--TriangleDown" fill="currentColor" viewBox="0 0 24 24" width="10" height="10"><path d="M20.044 3H3.956C2.876 3 2 3.517 2 4.9c0 .326.087.533.236.896L10.216 19c.355.571.87 1.143 1.784 1.143s1.429-.572 1.784-1.143l7.98-13.204c.149-.363.236-.57.236-.896 0-1.386-.876-1.9-1.956-1.9z" fill-rule="evenodd"></path></svg></span></button></span><button type="button" class="Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Comment Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z" fill-rule="evenodd"></path></svg></span>8 条评论</button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover6-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover6-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Share Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z" fill-rule="evenodd"></path></svg></span>分享</button></div></div><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Heart Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2 8.437C2 5.505 4.294 3.094 7.207 3 9.243 3 11.092 4.19 12 6c.823-1.758 2.649-3 4.651-3C19.545 3 22 5.507 22 8.432 22 16.24 13.842 21 12 21 10.158 21 2 16.24 2 8.437z" fill-rule="evenodd"></path></svg></span>喜欢</button><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Star Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z" fill-rule="evenodd"></path></svg></span>收藏</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="Popover7-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover7-content"><button type="button" class="Button Button--plain Button--withIcon Button--iconOnly"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Dots Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill-rule="evenodd"></path></svg></span></button></div></div></div></div><div class="Post-SideActions" style="opacity: 1;"><button class="like"><div class="Post-SideActions-icon"><svg class="Zi Zi--TriangleUp Post-SideActions-upIcon" fill="currentColor" viewBox="0 0 24 24" width="16" height="16"><path d="M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z" fill-rule="evenodd"></path></svg></div><div class="likeCount"><div class="likeCount-inner" data-previous="已赞同 100">赞同 99</div></div></button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover18-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover18-content"><button><div class="Post-SideActions-icon"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Share" fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z" fill-rule="evenodd"></path></svg></span></div>分享</button></div></div></div></div><div class="Sticky--holder" style="position: static; top: auto; right: auto; bottom: 0px; left: 0px; display: block; float: none; margin: 0px 0px 10px; height: 53.8068px;"></div></div></article><div class="Post-Sub Post-NormalSub"><div class="Recommendations-Main" style="width: 1644px;"><h3 class="BlockTitle Recommendations-BlockTitle">推荐阅读</h3><ul class="Recommendations-List"><button class="PagingButton PagingButton-Previous" disabled="" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg class="Zi Zi--ArrowLeft" fill="#d3d3d3" viewBox="0 0 24 24" width="40" height="40"><path d="M14.782 16.78a.737.737 0 0 1-1.052 0L9.218 12.53a.758.758 0 0 1 0-1.063L13.73 7.22a.737.737 0 0 1 1.052 0c.29.294.29.77.001 1.063L11 12l3.782 3.716c.29.294.29.77 0 1.063z" fill-rule="evenodd"></path></svg></button><a href="https://zhuanlan.zhihu.com/p/28998311" class="PostItem"><div><img src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-46b0a3ad934bcd6abe6de3cda4090a4c_250x0.jpg" srcset="https://pic4.zhimg.com/v2-46b0a3ad934bcd6abe6de3cda4090a4c_qhd.jpg 2x" class="PostItem-TitleImage" alt="用shader直接写出光线"><h1 class="PostItem-Title">用shader直接写出光线</h1><div class="PostItem-Footer"><span>雪落桑田</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/81672833" class="PostItem"><div><img src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-90fd785ce222694a74236cda0ccb73b8_250x0.jpg" srcset="https://pic1.zhimg.com/v2-90fd785ce222694a74236cda0ccb73b8_qhd.jpg 2x" class="PostItem-TitleImage" alt="Unity法线水,顺便利用CommandBuffer实现廉价的深度和截屏"><h1 class="PostItem-Title">Unity法线水,顺便利用CommandBuffer实现廉价的深度和截屏</h1><div class="PostItem-Footer"><span>lingz...</span><span class="PostItem-FooterTitle">发表于番茄的游戏...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/79214805" class="PostItem"><div><img src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-4cd4b5cb1c17df8b1110050af921021f_250x0.jpg" srcset="https://pic3.zhimg.com/v2-4cd4b5cb1c17df8b1110050af921021f_qhd.jpg 2x" class="PostItem-TitleImage" alt="Unity简单卡通水体"><h1 class="PostItem-Title">Unity简单卡通水体</h1><div class="PostItem-Footer"><span>SHENG</span><span class="PostItem-FooterTitle">发表于SHENG...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/90252566" class="PostItem"><div><img src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-aca3deda0317960f2b3f7ca3f19530b1_250x0.jpg" srcset="https://pic1.zhimg.com/v2-aca3deda0317960f2b3f7ca3f19530b1_qhd.jpg 2x" class="PostItem-TitleImage" alt="Unity Graphics 群友交流记录贴（干货）"><h1 class="PostItem-Title">Unity Graphics 群友交流记录贴（干货）</h1><div class="PostItem-Footer"><span>大崔</span><span class="PostItem-FooterTitle">发表于爱生活爱学...</span></div></div></a><button class="PagingButton PagingButton-Next" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg class="Zi Zi--ArrowRight" fill="#d3d3d3" viewBox="0 0 24 24" width="40" height="40"><path d="M9.218 16.78a.737.737 0 0 0 1.052 0l4.512-4.249a.758.758 0 0 0 0-1.063L10.27 7.22a.737.737 0 0 0-1.052 0 .759.759 0 0 0-.001 1.063L13 12l-3.782 3.716a.758.758 0 0 0 0 1.063z" fill-rule="evenodd"></path></svg></button></ul></div><div class="Comments-container" data-za-detail-view-path-module="CommentList" data-za-extra-module="{}"><div class="CommentsV2 CommentsV2--withEditor CommentsV2-withPagination"><div class="Topbar CommentTopbar"><div class="Topbar-title"><h2 class="CommentTopbar-title">8 条评论</h2></div><div class="Topbar-options"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Switch Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M13.004 7V4.232c0-.405.35-.733.781-.733.183 0 .36.06.501.17l6.437 5.033c.331.26.376.722.1 1.033a.803.803 0 0 1-.601.264H2.75a.75.75 0 0 1-.75-.75V7.75A.75.75 0 0 1 2.75 7h10.254zm-1.997 9.999v2.768c0 .405-.35.733-.782.733a.814.814 0 0 1-.5-.17l-6.437-5.034a.702.702 0 0 1-.1-1.032.803.803 0 0 1 .6-.264H21.25a.75.75 0 0 1 .75.75v1.499a.75.75 0 0 1-.75.75H11.007z" fill-rule="evenodd"></path></svg></span>切换为时间排序</button></div></div><div><div class="CommentsV2-footer CommentEditorV2--normal"><div class="CommentEditorV2-inputWrap"><div class="InputLike CommentEditorV2-input Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-4gbqp" style="white-space: pre-wrap;">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-4gbqp" class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="4gbqp" data-offset-key="bjk2c-0-0"><div data-offset-key="bjk2c-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="bjk2c-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><input multiple="" type="file" accept="image/jpg,image/jpeg,image/png,image/gif" style="display: none;"><div></div></div><div class="CommentEditorV2-inputUpload"><div class="CommentEditorV2-popoverWrap"><div class="Popover CommentEditorV2-inputUpLoad-Icon"><button aria-label="插入表情" data-tooltip="插入表情" data-tooltip-position="bottom" data-tooltip-will-hide-on-click="true" id="Popover8-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover8-content" type="button" class="Button Editable-control Button--plain"><svg class="Zi Zi--Emotion" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M7.523 13.5h8.954c-.228 2.47-2.145 4-4.477 4-2.332 0-4.25-1.53-4.477-4zM12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm0-1.5a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zm-3-8a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm6 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"></path></svg></button></div></div></div></div><button disabled="" type="button" class="Button CommentEditorV2-singleButton Button--primary Button--blue">发布</button></div></div><div><div class="CommentListV2"><ul class="NestComment"><li class="NestComment--rootCommentNoChild"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover11-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover11-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/wu-he-zhi-zhong-75-23"><img class="Avatar UserLink-avatar" width="24" height="24" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/da8e974dc_s.jpg" srcset="https://pic4.zhimg.com/da8e974dc_xs.jpg 2x" alt="乌合之众"></a></div></div></span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/wu-he-zhi-zhong-75-23">乌合之众</a></span><span class="CommentItemV2-time">1 年前</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext">还有阴影抖动问题吧 移动镜头时 反转相机会超出包围盒吧</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>2</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Reply" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z" fill-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="transform: rotate(180deg); margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Report" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z" fill-rule="evenodd"></path></svg></span>举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootCommentNoChild"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover12-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover12-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/yidi-xie-de-ji-yi"><img class="Avatar UserLink-avatar" width="24" height="24" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-a36012bc4de9dc18c76faa585d1532f4_s.jpg" srcset="https://pic4.zhimg.com/v2-a36012bc4de9dc18c76faa585d1532f4_xs.jpg 2x" alt="一滴血的记忆"></a></div></div></span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/yidi-xie-de-ji-yi">一滴血的记忆</a></span><span class="CommentItemV2-time">1 年前</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext">大佬好棒</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Reply" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z" fill-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="transform: rotate(180deg); margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Report" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z" fill-rule="evenodd"></path></svg></span>举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootCommentNoChild"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover13-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover13-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/whatyour-name"><img class="Avatar UserLink-avatar" width="24" height="24" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-cd593efaa4857a62667e05f3d696201b_s.jpg" srcset="https://pic1.zhimg.com/v2-cd593efaa4857a62667e05f3d696201b_xs.jpg 2x" alt="0110君"></a></div></div></span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/whatyour-name">0110君</a></span><span class="CommentItemV2-time">1 年前</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext">good，enjoy it～</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Reply" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z" fill-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="transform: rotate(180deg); margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Report" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z" fill-rule="evenodd"></path></svg></span>举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootCommentNoChild"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover14-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover14-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/shi-ling-64"><img class="Avatar UserLink-avatar" width="24" height="24" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/v2-612fbb3b8ca562bbe9f5b497138d052e_s.jpg" srcset="https://pic2.zhimg.com/v2-612fbb3b8ca562bbe9f5b497138d052e_xs.jpg 2x" alt="无名无姓"></a></div></div></span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/shi-ling-64">无名无姓</a></span><span class="CommentItemV2-time">2 个月前</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext">棒棒哒</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Reply" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z" fill-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="transform: rotate(180deg); margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Report" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z" fill-rule="evenodd"></path></svg></span>举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootComment"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover15-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover15-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/guardhei"><img class="Avatar UserLink-avatar" width="24" height="24" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/da8e974dc_s.jpg" srcset="https://pic4.zhimg.com/da8e974dc_xs.jpg 2x" alt="GuardHei"></a></div></div></span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/guardhei">GuardHei</a></span><span class="CommentItemV2-time">1 个月前</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext">为啥要采样四次，把包围盒传到shader里算一下点在哪个级了然后采样不就好了？哪怕要做级之间的过渡，采样两级也就可以了。你这样再加上pcf做的软阴影的话采样数怕不是要爆炸了[捂脸]</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>1</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Reply" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z" fill-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="transform: rotate(180deg); margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Report" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z" fill-rule="evenodd"></path></svg></span>举报</button></div></div></div></div></li><li class="NestComment--child"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover16-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover16-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/wang-yong-bao-64"><img class="Avatar UserLink-avatar" width="24" height="24" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/261207c0e_s.jpg" srcset="https://pic3.zhimg.com/261207c0e_xs.jpg 2x" alt="王永宝"></a></div></div></span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/wang-yong-bao-64">王永宝</a></span><span class="CommentItemV2-reply">回复</span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/guardhei">GuardHei</a></span><span class="CommentItemV2-time">12 天前</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext"><p>为了解决2个连级之间衔接的问题，这篇文章的图9可以直观地让你理解到这个问题，过渡的地方会看到阴影的衔接不是连续的</p></div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Reply" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z" fill-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="transform: rotate(180deg); margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Report" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z" fill-rule="evenodd"></path></svg></span>举报</button></div></div></div></div></li><li class="NestComment--child"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover17-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover17-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/wang-yong-bao-64"><img class="Avatar UserLink-avatar" width="24" height="24" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/261207c0e_s.jpg" srcset="https://pic3.zhimg.com/261207c0e_xs.jpg 2x" alt="王永宝"></a></div></div></span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/wang-yong-bao-64">王永宝</a></span><span class="CommentItemV2-reply">回复</span><span class="UserLink"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/guardhei">GuardHei</a></span><span class="CommentItemV2-time">12 天前</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext"><p><a href="http://link.zhihu.com/?target=https%3A//docs.microsoft.com/zh-cn/windows/win32/dxtecharts/cascaded-shadow-maps" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">docs.microsoft.com/zh-c</span><span class="invisible">n/windows/win32/dxtecharts/cascaded-shadow-maps</span><span class="ellipsis"></span></a></p></div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Reply" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z" fill-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Like" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="transform: rotate(180deg); margin-right: 5px;"><path d="M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z" fill-rule="evenodd"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Report" fill="currentColor" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 5px;"><path d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z" fill-rule="evenodd"></path></svg></span>举报</button></div></div></div></div></li><div><div class="CommentMoreReplyButton"><button type="button" class="Button Button--plain">展开其他 1 条回复</button></div></div></ul></div></div></div></div></div></div></main><div class="CornerButtons"><div class="CornerAnimayedFlex"><button data-tooltip="建议反馈" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="建议反馈" type="button" class="Button CornerButton Button--plain"><svg class="Zi Zi--Feedback" title="建议反馈" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M19.99 6.99L18 5s-1-1-2-1H8C7 4 6 5 6 5L4 7S3 8 3 9v9s0 2 2.002 2H19c2 0 2-2 2-2V9c0-1-1.01-2.01-1.01-2.01zM16.5 5.5L19 8H5l2.5-2.5h9zm-2 5.5s.5 0 .5.5-.5.5-.5.5h-5s-.5 0-.5-.5.5-.5.5-.5h5z"></path></svg></button></div><div class="CornerAnimayedFlex CornerAnimayedFlex--hidden"><button data-tooltip="回到顶部" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部" type="button" class="Button CornerButton Button--plain"><svg class="Zi Zi--BackToTop" title="回到顶部" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button></div></div></div></div><script nonce="" async="" src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/js"></script><script nonce="">function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-149949619-1");</script><script id="js-clientConfig" type="text/json">{"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com"}}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false}},"entities":{"users":{"chen-yong-59-86":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e40ac9d11102ff4fe9936980a729b5be_{size}.jpg","uid":"847414572573925376","userType":"people","isFollowing":false,"urlToken":"chen-yong-59-86","id":"7f6ed2841008602cc261c3bc675a1c18","description":"https:\u002F\u002Fgithub.com\u002Fchenyong2github","name":"YOung","isAdvertiser":false,"headline":"引擎程序&amp;TA","gender":1,"url":"\u002Fpeople\u002F7f6ed2841008602cc261c3bc675a1c18","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e40ac9d11102ff4fe9936980a729b5be_l.jpg","isOrg":false,"type":"people","badge":[],"exposedMedal":{"medalId":"972465637922213888","medalName":"给自己证明","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-95e2940e8968c11fac86cb9f3c59ca97_r.png","miniAvatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-2b8cb24c96e95d6274794c29f35c912e_is.png","description":"已完善全部个人资料"}}},"questions":{},"answers":{},"articles":{"45673049":{"id":45673049,"title":"Unity实时阴影实现——Cascaded Shadow Mapping","type":"article","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F45673049","imageUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-20d9b6be595ab0f8af100c80c7f56c22_b.jpg","titleImage":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-20d9b6be595ab0f8af100c80c7f56c22_b.jpg","excerpt":"\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-a07a217bfd64341529a29dfada76d3d6_200x112.jpg\" data-caption=\"2级shadow map采样示意图\" data-size=\"normal\" data-rawwidth=\"654\" data-rawheight=\"326\" data-watermark=\"watermark\" data-original-src=\"v2-a07a217bfd64341529a29dfada76d3d6\" data-watermark-src=\"v2-6144c71631f8a0ab8634abbc2b801ff0\" data-private-watermark-src=\"\" class=\"origin_image inline-img zh-lightbox-thumb\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-a07a217bfd64341529a29dfada76d3d6_r.jpg\"\u002F\u003E\u003Cb\u003E前言\u003C\u002Fb\u003EUnity内置的方向光实时阴影技术是Cascaded Shadow Mapping(简称CSM)。 由于Unity封装的原因，可能并不能满足实际项目实时阴影的需求，但我们可以从Unity开源出来的built-in shaders看出一些实现细节，这些可以作为自定义实现CSM的参考。\u003Cb\u003E简述\u003C\u002Fb\u003EPerspective…","created":1538215206,"updated":1542275309,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e40ac9d11102ff4fe9936980a729b5be_{size}.jpg","uid":"847414572573925376","userType":"people","isFollowing":false,"urlToken":"chen-yong-59-86","id":"7f6ed2841008602cc261c3bc675a1c18","description":"https:\u002F\u002Fgithub.com\u002Fchenyong2github","name":"YOung","isAdvertiser":false,"headline":"引擎程序&amp;TA","gender":1,"url":"\u002Fpeople\u002F7f6ed2841008602cc261c3bc675a1c18","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e40ac9d11102ff4fe9936980a729b5be_l.jpg","isOrg":false,"type":"people","badge":[],"exposedMedal":{"medalId":"972465637922213888","medalName":"给自己证明","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-95e2940e8968c11fac86cb9f3c59ca97_r.png","miniAvatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-2b8cb24c96e95d6274794c29f35c912e_is.png","description":"已完善全部个人资料"}},"commentPermission":"all","state":"published","imageWidth":1810,"imageHeight":870,"content":"\u003Ch2\u003E\u003Cb\u003E前言\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003EUnity内置的方向光实时阴影技术是Cascaded Shadow Mapping(简称CSM)。 由于Unity封装的原因，可能并不能满足实际项目实时阴影的需求，但我们可以从Unity开源出来的built-in shaders看出一些实现细节，这些可以作为自定义实现CSM的参考。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E简述\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cblockquote\u003EPerspective aliasing in a shadow map is one of the most difficult problems to overcome. In the technical article, Common Techniques to Improve Shadow Depth Maps, perspective aliasing is described and some approaches to mitigate the problem are identified. In practice, CSMs tend to be the best solution, and are commonly employed in modern games.The basic concept of CSMs is easy to understand. Different areas of the camera frustum require shadow maps with different resolutions. Objects nearest the eye require a higher resolution than do more distant objects. In fact, when the eye moves very close to the geometry, the pixels nearest the eye can require so much resolution that even a 4096 × 4096 shadow map is insufficient.\u003C\u002Fblockquote\u003E\u003Cp\u003E基本的Shadow mapping在大场景下存在阴影图精度问题：\u003C\u002Fp\u003E\u003Cp\u003E1.主相机整个视锥生成一张阴影图，会导致单个物体占用阴影图的比例太小，读取阴影图时出现采样精度不够（多个像素采样一个图素），产生锯齿。使用尺寸更大的阴影图可以改善这个问题，但会导致内存使用增加。\u003C\u002Fp\u003E\u003Cp\u003E2.相机近端和远端物体对阴影图采样精度一样，会导致近端物体采样精度不够，远端物体采样精度浪费。\u003C\u002Fp\u003E\u003Cp\u003E大场景方向光动态阴影的解决方案一般是采用CSM技术。CSM通过把相机的视锥体按远近划分为几个级别，处于各个级别下的物体深度信息绘制到各级阴影图中，显示时采样各自对应的阴影图。见下图示意：\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-6144c71631f8a0ab8634abbc2b801ff0_b.jpg\" data-size=\"normal\" data-rawwidth=\"654\" data-rawheight=\"326\" class=\"origin_image zh-lightbox-thumb\" width=\"654\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-6144c71631f8a0ab8634abbc2b801ff0_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;654&#39; height=&#39;326&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"654\" data-rawheight=\"326\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"654\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-6144c71631f8a0ab8634abbc2b801ff0_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-6144c71631f8a0ab8634abbc2b801ff0_b.jpg\"\u002F\u003E\u003Cfigcaption\u003E2级shadow map采样示意图\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cb\u003E实现\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E下面简述用Unity实现的大致步骤。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E灯光相机视锥\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E正交的灯光相机视锥为长方体，为了减少灯光相机的无效绘制，需调整大小为主相机视锥的包围盒。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E获取主相机视锥顶点\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-c\"\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EInitFrustumCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFrustumCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFrustumCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003ECalcMainCameraFrustumCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECalculateFrustumCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERect\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearClipPlane\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMonoOrStereoscopicEye\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMono\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETransformPoint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECalculateFrustumCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERect\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarClipPlane\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E  \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMonoOrStereoscopicEye\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMono\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETransformPoint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这里用到了Unity的API：CalculateFrustumCorners，可方便获取相机Local的视锥顶点坐标，使用时需转换到World空间下。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E计算灯光相机包围盒\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E因为计算得到的包围盒会被直接作为灯光相机的视锥，所以一般包围盒的计算转换到灯光相机空间进行。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E\u003Cspan class=\"k\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECalcLightCameraFrustum\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E++)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[i]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInverseTransformPoint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[i]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[i]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInverseTransformPoint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmainCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[i]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Exs\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eys\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ezs\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminX\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMathf\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxX\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMathf\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMax\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminY\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMathf\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eys\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxY\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMathf\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMax\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eys\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminZ\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMathf\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ezs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxZ\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EMathf\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMax\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ezs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EminX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmaxX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmaxX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EminX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EminX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmaxX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmaxX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EminX\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E得到的包围盒用线框绘制出来见下图：\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-994fe426be2fe19ff823af04ce98f33b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"451\" data-rawheight=\"406\" class=\"origin_image zh-lightbox-thumb\" width=\"451\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-994fe426be2fe19ff823af04ce98f33b_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;451&#39; height=&#39;406&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"451\" data-rawheight=\"406\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"451\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-994fe426be2fe19ff823af04ce98f33b_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-994fe426be2fe19ff823af04ce98f33b_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E上图的灰色线框表示主相机视锥，绿色线框表示包围盒，红色线框表示近平面。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E构造灯光相机\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E\u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eposition\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETransformPoint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erotation\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdirLight\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etransform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erotation\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearClipPlane\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EminZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfarClipPlane\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmaxZ\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Easpect\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMagnitude\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMagnitude\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EorthographicSize\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVector3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMagnitude\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElightCamera_fcs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EnearCorners\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上述代码设置灯光相机的视锥参数(也是灯光相机的投影矩阵)nearClipPlane，farClipPlane，aspect和orthographicSize。\u003C\u002Fp\u003E\u003Cp\u003E灯光相机的位置和朝向也需要设置，其中位置为近平面的中点，计算方法见下图：\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-f8df1b238e9b0b8d48204424d79e19c8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"427\" data-rawheight=\"393\" class=\"origin_image zh-lightbox-thumb\" width=\"427\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-f8df1b238e9b0b8d48204424d79e19c8_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;427&#39; height=&#39;393&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"427\" data-rawheight=\"393\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"427\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-f8df1b238e9b0b8d48204424d79e19c8_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-f8df1b238e9b0b8d48204424d79e19c8_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fwww.zhihu.com\u002Fequation?tex=%5Cvec%7BOP%7D+%3D+%5Cvec%7BOA%7D+%2B+%5Cvec%7BAP%7D+%3D+%5Cvec%7BOA%7D+%2B+%5Cfrac%7B%5Cvec%7BAC%7D%7D%7B2%7D\" alt=\"\\vec{OP} = \\vec{OA} + \\vec{AP} = \\vec{OA} + \\frac{\\vec{AC}}{2}\" eeimg=\"1\"\u002F\u003E \u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E主相机视锥分割\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003EUnity的QualitySettings里提供了对相机视锥的分割设置，见下图：\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a4ecc1af2e26dc575539a7804a5dfa2b_b.jpg\" data-size=\"normal\" data-rawwidth=\"627\" data-rawheight=\"70\" class=\"origin_image zh-lightbox-thumb\" width=\"627\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a4ecc1af2e26dc575539a7804a5dfa2b_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;627&#39; height=&#39;70&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"627\" data-rawheight=\"70\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"627\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a4ecc1af2e26dc575539a7804a5dfa2b_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a4ecc1af2e26dc575539a7804a5dfa2b_b.jpg\"\u002F\u003E\u003Cfigcaption\u003EUnity4级视锥分割参数\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EUnityShaderVariables.cginc用以下变量保存分割参数：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_LightSplitsNear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_LightSplitsFar\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这里类似实现：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_LightSplitsNear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_LightSplitsFar\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enears\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.067f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.133f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.067f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.267f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.133f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.067f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enear\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efars\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.067f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.133f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.067f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.267f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.133f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.067f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003E_LightSplitsNear\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enears\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003E_LightSplitsFar\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efars\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E++)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E\u002F\u002F计算主相机分割视锥\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E\u002F\u002F计算分割视锥的灯光相机包围盒\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E得到的分割包围盒见下图：\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-aa29ed68a52a5491c8b98bcfa80d491d_b.jpg\" data-size=\"normal\" data-rawwidth=\"650\" data-rawheight=\"581\" class=\"origin_image zh-lightbox-thumb\" width=\"650\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-aa29ed68a52a5491c8b98bcfa80d491d_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;650&#39; height=&#39;581&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"650\" data-rawheight=\"581\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"650\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-aa29ed68a52a5491c8b98bcfa80d491d_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-aa29ed68a52a5491c8b98bcfa80d491d_b.jpg\"\u002F\u003E\u003Cfigcaption\u003EUnity4级视锥分割俯视图\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E级联阴影图生成\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E级联灯光相机通过设置各个级别的视锥依次绘制便得到各自对应阴影图：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E\u003Cspan class=\"n\"\u003EList\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMatrix4x4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eworld2ShadowMats\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EList\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMatrix4x4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;(\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003ERenderTexture\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdepthTextures\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERenderTexture\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[4]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E++)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EdepthTextures\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[i]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERenderTexture\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E1024\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1024\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E24\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ErtFormat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EShader\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESetGlobalTexture\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;_gShadowMapTexture&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdepthTextures\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[i]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Eworld2ShadowMats\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EClear\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E++)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EConstructLightCameraSplits\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EtargetTexture\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdepthTextures\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[i]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERenderWithShader\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EshadowCaster\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EprojectionMatrix\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EGL\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EGetGPUProjectionMatrix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EprojectionMatrix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eworld2ShadowMats\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAdd\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EprojectionMatrix\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EdirLightCamera\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EworldToCameraMatrix\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E            \n\n\u003Cspan class=\"n\"\u003EShader\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESetGlobalMatrixArray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;_gWorld2Shadow&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eworld2ShadowMats\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EUnity底层实现是用一张2x2阴影图集来保存4级阴影图。由于我使用的Unity版本原因，这里使用4张单独的rt来分别保存。\u003C\u002Fp\u003E\u003Cp\u003E\u003Ci\u003EUnity2017新版本里已经加入对RenderTexture分区域更新的特性，这样便也可以在上层实现类似底层的级联阴影图集。\u003C\u002Fi\u003E\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ed56a447f18cc31f09d185dba06b1b43_b.jpg\" data-size=\"normal\" data-rawwidth=\"584\" data-rawheight=\"581\" class=\"origin_image zh-lightbox-thumb\" width=\"584\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ed56a447f18cc31f09d185dba06b1b43_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;584&#39; height=&#39;581&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"584\" data-rawheight=\"581\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"584\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ed56a447f18cc31f09d185dba06b1b43_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ed56a447f18cc31f09d185dba06b1b43_b.jpg\"\u002F\u003E\u003Cfigcaption\u003E4级级联阴影图\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003E\u003Cb\u003E级联阴影图采样\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003EUnityShaderVariables.cginc用以下变量保存分割后的世界坐标到光源空间投影坐标的矩阵变换：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E\u003Cspan class=\"n\"\u003Efloat4x4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eunity_WorldToShadow\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[4]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E配合视锥分割参数和片段深度可获取对应级联索引，Internal-ScreenSpaceShadows.cginc：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Einline fixed4 getCascadeWeights(float3 wpos, float z)\n{\n    fixed4 zNear = float4( z &gt;= _LightSplitsNear );\n    fixed4 zFar = float4( z &lt; _LightSplitsFar );\n    fixed4 weights = zNear * zFar;\n\n    return weights;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上面函数传进来的片段世界坐标wpos并没有用：（，返回值4个分量均为布尔值，比如z值0.4得到的返回值为fixed4（0,0,1,0)，表示对应3级的矩阵变换和阴影图。\u003C\u002Fp\u003E\u003Cp\u003E这里类似实现：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E\u003Cspan class=\"n\"\u003Euniform\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efloat4x4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_gWorld2Shadow\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[4]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESampleShadowTexture\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EwPos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efixed4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EcascadeWeights\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gWorld2Shadow\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EwPos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gWorld2Shadow\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EwPos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gWorld2Shadow\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EwPos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gWorld2Shadow\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EwPos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etex2D\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gShadowMapTexture0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etex2D\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gShadowMapTexture1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etex2D\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gShadowMapTexture2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Efloat4\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etex2D\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_gShadowMapTexture3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Exy\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ez\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EshadowCoord3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"cp\"\u003E#if defined (SHADER_TARGET_GLSL)\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"n\"\u003Edepth0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F(-1, 1)--&gt;(0, 1)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"n\"\u003Edepth1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edepth2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edepth3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E0.5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"cp\"\u003E#elif defined (UNITY_REVERSED_Z)\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"n\"\u003Edepth0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E       \u003Cspan class=\"c1\"\u003E\u002F\u002F(1, 0)--&gt;(0, 1)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"n\"\u003Edepth1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edepth2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Edepth3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"cp\"\u003E#endif\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth0\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_gShadowStrength\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_gShadowStrength\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth2\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_gShadowStrength\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EsampleDepth3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edepth3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_gShadowStrength\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002Freturn col0;\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcascadeWeights\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[0]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcascadeWeights\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[1]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcascadeWeights\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[2]\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcascadeWeights\u003C\u002Fspan\u003E\u003Cspan class=\"na\"\u003E[3]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003E\u003Cb\u003EShadow Cascadeds查看模式\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003EUnity的Scene模式下有一个Shadow Cascadeds查看模式，可以方便查看整个场景的级联阴影图分布。\u003C\u002Fp\u003E\u003Cp\u003E这种效果简单实现可以把级联级别作为颜色参数叠加到阴影颜色上即可：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-csharp\"\u003E\u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eshadow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EcascadeWeights\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-78e050d7791d92222637998e469c7e2a_b.jpg\" data-size=\"normal\" data-rawwidth=\"1143\" data-rawheight=\"597\" class=\"origin_image zh-lightbox-thumb\" width=\"1143\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-78e050d7791d92222637998e469c7e2a_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1143&#39; height=&#39;597&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"1143\" data-rawheight=\"597\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1143\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-78e050d7791d92222637998e469c7e2a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-78e050d7791d92222637998e469c7e2a_b.jpg\"\u002F\u003E\u003Cfigcaption\u003EUnity自带和自实现的Shadow Cascadeds查看模式对比\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003E\u003Cb\u003E结论\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003ECSM能有效解决透视相机下的阴影锯齿问题，基本的SM通过增加阴影图大小可改善阴影质量，但不能根本解决问题。\u003C\u002Fp\u003E\u003Cp\u003E下面展示了同场景下SM和CSM的阴影质量对比，明显可看出CSM使用相同大小的阴影图(2048x2048 = 4x1024x1024)，但获得了好得多的阴影质量。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-08176c44d24379c2c5baf68dd177cc6a_b.jpg\" data-size=\"normal\" data-rawwidth=\"1150\" data-rawheight=\"611\" class=\"origin_image zh-lightbox-thumb\" width=\"1150\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-08176c44d24379c2c5baf68dd177cc6a_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1150&#39; height=&#39;611&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"1150\" data-rawheight=\"611\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1150\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-08176c44d24379c2c5baf68dd177cc6a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-08176c44d24379c2c5baf68dd177cc6a_b.jpg\"\u002F\u003E\u003Cfigcaption\u003E单张2048的阴影贴图和4张1024级联阴影贴图阴影效果对比\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E当然，CSM存在重复绘制和多次采样的问题，这也是Unity的CSM方案对mobile平台缺省为1个cascade的原因。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E完整代码见：\u003C\u002Fp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fchenyong2github\u002FCascadedShadowMapping\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-06ce3400e350c07c493f688d7b2326e6_ipico.jpg\" data-image-width=\"184\" data-image-height=\"184\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Echenyong2github\u002FCascadedShadowMapping\u003C\u002Fa\u003E\u003Cp\u003E参考文献：\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmsdn.microsoft.com\u002Fen-us\u002Flibrary\u002Fwindows\u002Fdesktop\u002Fee416307%28v%3Dvs.85%29.aspx\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ECascaded Shadow Maps\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fogldev.atspace.co.uk\u002Fwww\u002Ftutorial49\u002Ftutorial49.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ECascaded Shadow Mapping\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19568806","type":"topic","id":"19568806","name":"Unity（游戏引擎）"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19613730","type":"topic","id":"19613730","name":"计算机图形学"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F20140337","type":"topic","id":"20140337","name":"实时渲染"}],"voteupCount":99,"voting":0,"commentCount":8,"contributions":[],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":true,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"isNormal":true,"status":0,"shareText":"Unity实时阴影实现——Cascaded Shadow Mapping - 来自知乎专栏，作者: YOung https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F45673049 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":0,"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fpage_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=__MEMBERID__&idfa=__IDFA__&imei=__IMEI__&androidid=__ANDROIDID__&oaid=__OAID__&ci=__CREATIVEID__"]}},"columns":{},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"clubs":{},"clubTags":{}},"currentUser":"","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false}},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{}},"env":{"ab":{"config":{"experiments":[{"expId":"launch-gw_mweb_rec-1","expPrefix":"gw_mweb_rec","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-qa_hdpimg-2","expPrefix":"qa_hdpimg","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-us_foltopic_user-10","expPrefix":"us_foltopic_user","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"vd_bullet_gui-3","expPrefix":"vd_bullet_gui","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"vd_bullet_second-5","expPrefix":"vd_bullet_second","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"vd_zvideo_link-2","expPrefix":"vd_zvideo_link","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false}],"params":[{"id":"li_ebook_audio","type":"String","value":"0","chainId":"_all_"},{"id":"se_zu_onebox","type":"String","value":"0","chainId":"_all_"},{"id":"top_v_album","type":"String","value":"1","chainId":"_all_"},{"id":"se_ad_index","type":"String","value":"10","chainId":"_all_"},{"id":"se_websearch","type":"String","value":"3","chainId":"_all_"},{"id":"tp_header_style","type":"String","value":"1","chainId":"_all_"},{"id":"soc_iospinweight","type":"String","value":"0","chainId":"_all_"},{"id":"soc_iosreadfilter","type":"String","value":"0","chainId":"_all_"},{"id":"soc_iossort","type":"String","value":"0","chainId":"_all_"},{"id":"se_cate_l3","type":"String","value":"0","chainId":"_all_"},{"id":"se_relation_1","type":"String","value":"0","chainId":"_all_"},{"id":"se_relationship","type":"String","value":"0","chainId":"_all_"},{"id":"soc_newfeed","type":"String","value":"2","chainId":"_all_"},{"id":"top_universalebook","type":"String","value":"1","chainId":"_all_"},{"id":"li_answer_right","type":"String","value":"0","chainId":"_all_"},{"id":"li_query_match","type":"String","value":"0","chainId":"_all_"},{"id":"gue_self_censoring","type":"String","value":"0"},{"id":"top_ydyq","type":"String","value":"X","chainId":"_all_"},{"id":"se_hotsearch_num","type":"String","value":"0","chainId":"_all_"},{"id":"se_p_slideshow","type":"String","value":"0","chainId":"_all_"},{"id":"tp_topic_head","type":"String","value":"0","chainId":"_all_"},{"id":"ug_follow_answerer","type":"String","value":"0","chainId":"_all_"},{"id":"se_ltr_video","type":"String","value":"0","chainId":"_all_"},{"id":"se_amovietab","type":"String","value":"1","chainId":"_all_"},{"id":"tp_qa_metacard","type":"String","value":"1","chainId":"_all_"},{"id":"soc_zcfw_shipinshiti","type":"String","value":"1","chainId":"_all_"},{"id":"se_expired_ob","type":"String","value":"0","chainId":"_all_"},{"id":"se_bert_comp","type":"String","value":"0","chainId":"_all_"},{"id":"ls_recommend_test","type":"String","value":"0","chainId":"_all_"},{"id":"web_hdpimg","type":"String","value":"1"},{"id":"se_cbert","type":"String","value":"0","chainId":"_all_"},{"id":"tp_club_pic_swiper","type":"String","value":"0","chainId":"_all_"},{"id":"tp_sticky_android","type":"String","value":"2","chainId":"_all_"},{"id":"soc_iosreadline","type":"String","value":"0","chainId":"_all_"},{"id":"li_catalog_card","type":"String","value":"1","chainId":"_all_"},{"id":"se_rel_search","type":"String","value":"0","chainId":"_all_"},{"id":"tp_club_android_join","type":"String","value":"1","chainId":"_all_"},{"id":"soc_authormore","type":"String","value":"2","chainId":"_all_"},{"id":"se_click_club","type":"String","value":"0","chainId":"_all_"},{"id":"top_quality","type":"String","value":"0","chainId":"_all_"},{"id":"web_mini_review","type":"String","value":"0"},{"id":"tp_topic_rec","type":"String","value":"1","chainId":"_all_"},{"id":"gue_zvideo_link","type":"String","value":"0"},{"id":"li_ebok_chap","type":"String","value":"0","chainId":"_all_"},{"id":"zw_sameq_sorce","type":"String","value":"999","chainId":"_all_"},{"id":"se_waterfall","type":"String","value":"0","chainId":"_all_"},{"id":"se_time_threshold","type":"String","value":"0","chainId":"_all_"},{"id":"li_svip_tab_search","type":"String","value":"0","chainId":"_all_"},{"id":"zr_update_merge_size","type":"String","value":"1","chainId":"_all_"},{"id":"se_highlight","type":"String","value":"0","chainId":"_all_"},{"id":"soc_leave_recommend","type":"String","value":"2","chainId":"_all_"},{"id":"tsp_vote","type":"String","value":"2","chainId":"_all_"},{"id":"li_paid_answer_exp","type":"String","value":"0","chainId":"_all_"},{"id":"li_se_media_icon","type":"String","value":"1","chainId":"_all_"},{"id":"gue_new_special_page","type":"String","value":"1"},{"id":"web_upload","type":"String","value":"0"},{"id":"tp_club_qa_pic","type":"String","value":"1","chainId":"_all_"},{"id":"gue_bullet_second","type":"String","value":"1"},{"id":"zr_art_rec","type":"String","value":"base","chainId":"_all_"},{"id":"zr_training_prerank","type":"String","value":"0","chainId":"_all_"},{"id":"soc_userrec","type":"String","value":"0","chainId":"_all_"},{"id":"ug_newtag","type":"String","value":"0","chainId":"_all_"},{"id":"web_answer_update","type":"String","value":"0"},{"id":"qap_payc_invite","type":"String","value":"0","chainId":"_all_"},{"id":"zw_payc_qaedit","type":"String","value":"0","chainId":"_all_"},{"id":"se_hotsearch","type":"String","value":"0","chainId":"_all_"},{"id":"se_payconsult","type":"String","value":"0","chainId":"_all_"},{"id":"se_cardrank_2","type":"String","value":"1","chainId":"_all_"},{"id":"soc_adpinweight","type":"String","value":"0","chainId":"_all_"},{"id":"soc_cardheight","type":"String","value":"2","chainId":"_all_"},{"id":"qap_article_like","type":"String","value":"1","chainId":"_all_"},{"id":"se_likebutton","type":"String","value":"0","chainId":"_all_"},{"id":"tp_club_pk","type":"String","value":"1","chainId":"_all_"},{"id":"soc_brdcst4","type":"String","value":"3","chainId":"_all_"},{"id":"top_new_feed","type":"String","value":"5","chainId":"_all_"},{"id":"ug_zero_follow_0","type":"String","value":"0","chainId":"_all_"},{"id":"se_entity_model_14","type":"String","value":"0","chainId":"_all_"},{"id":"se_backsearch","type":"String","value":"0","chainId":"_all_"},{"id":"ls_videoad","type":"String","value":"2","chainId":"_all_"},{"id":"web_heifetz_grow_ad","type":"String","value":"1"},{"id":"web_sem_ab","type":"String","value":"1"},{"id":"gue_card_test","type":"String","value":"1"},{"id":"zr_ans_rec","type":"String","value":"gbrank","chainId":"_all_"},{"id":"se_pek_test3","type":"String","value":"1","chainId":"_all_"},{"id":"tp_club_pic","type":"String","value":"0.6","chainId":"_all_"},{"id":"tp_topic_style","type":"String","value":"0","chainId":"_all_"},{"id":"soc_brdcst3","type":"String","value":"0","chainId":"_all_"},{"id":"gue_video_autoplay","type":"String","value":"0"},{"id":"li_qa_btn_text","type":"String","value":"0","chainId":"_all_"},{"id":"se_colorfultab","type":"String","value":"1","chainId":"_all_"},{"id":"soc_wonderuser_recom","type":"String","value":"2","chainId":"_all_"},{"id":"soc_zcfw_badcase","type":"String","value":"0","chainId":"_all_"},{"id":"soc_stickypush","type":"String","value":"1","chainId":"_all_"},{"id":"li_purchase_test","type":"String","value":"0","chainId":"_all_"},{"id":"zr_km_sku_mix","type":"String","value":"sku_20","chainId":"_all_"},{"id":"zr_video_rank_nn","type":"String","value":"new_rank","chainId":"_all_"},{"id":"se_pek_test2","type":"String","value":"1","chainId":"_all_"},{"id":"se_presearch_ab","type":"String","value":"0","chainId":"_all_"},{"id":"tp_club_tab_feed","type":"String","value":"0","chainId":"_all_"},{"id":"se_pek_test","type":"String","value":"1","chainId":"_all_"},{"id":"se_mobileweb","type":"String","value":"1","chainId":"_all_"},{"id":"tp_club_tab","type":"String","value":"0","chainId":"_all_"},{"id":"gue_bullet_guide","type":"String","value":"没弹幕？你是第一个"},{"id":"zr_video_recall","type":"String","value":"current_recall","chainId":"_all_"},{"id":"se_aa_base","type":"String","value":"0","chainId":"_all_"},{"id":"top_test_4_liguangyi","type":"String","value":"1","chainId":"_all_"},{"id":"pf_creator_card","type":"String","value":"1","chainId":"_all_"},{"id":"pf_fuceng","type":"String","value":"1","chainId":"_all_"},{"id":"li_se_heat","type":"String","value":"1","chainId":"_all_"},{"id":"zr_rel_search","type":"String","value":"base","chainId":"_all_"},{"id":"se_webrs","type":"String","value":"1","chainId":"_all_"},{"id":"se_hot_timebox","type":"String","value":"0","chainId":"_all_"},{"id":"se_movietab","type":"String","value":"1","chainId":"_all_"},{"id":"soc_adsort","type":"String","value":"0","chainId":"_all_"},{"id":"web_ad_banner","type":"String","value":"0"},{"id":"soc_bignew","type":"String","value":"1","chainId":"_all_"},{"id":"web_question_invite","type":"String","value":"B"},{"id":"se_ios_spb309","type":"String","value":"0","chainId":"_all_"},{"id":"se_timebox_up","type":"String","value":"0","chainId":"_all_"},{"id":"se_whitelist","type":"String","value":"0","chainId":"_all_"},{"id":"se_preset_tech","type":"String","value":"0","chainId":"_all_"},{"id":"li_search_v5","type":"String","value":"0","chainId":"_all_"},{"id":"web_column_auto_invite","type":"String","value":"0"},{"id":"tp_club_header","type":"String","value":"1","chainId":"_all_"},{"id":"tp_topic_entry","type":"String","value":"0","chainId":"_all_"},{"id":"li_video_section","type":"String","value":"0","chainId":"_all_"},{"id":"qap_thanks","type":"String","value":"1","chainId":"_all_"},{"id":"zr_slot_training","type":"String","value":"1","chainId":"_all_"},{"id":"se_spb309","type":"String","value":"0","chainId":"_all_"},{"id":"li_se_edu","type":"String","value":"0","chainId":"_all_"},{"id":"li_pay_banner_type","type":"String","value":"6","chainId":"_all_"},{"id":"li_tjys_ec_ab","type":"String","value":"0","chainId":"_all_"},{"id":"web_audit_01","type":"String","value":"case1"},{"id":"zr_km_sku_thres","type":"String","value":"false","chainId":"_all_"},{"id":"se_entity_model","type":"String","value":"0","chainId":"_all_"},{"id":"tp_club_qa","type":"String","value":"1","chainId":"_all_"},{"id":"top_root","type":"String","value":"0","chainId":"_all_"},{"id":"se_topiclabel","type":"String","value":"1","chainId":"_all_"},{"id":"se_sug_term","type":"String","value":"0","chainId":"_all_"},{"id":"soc_adreadline","type":"String","value":"0","chainId":"_all_"},{"id":"soc_ri_merge","type":"String","value":"0","chainId":"_all_"},{"id":"se_site_onebox","type":"String","value":"0","chainId":"_all_"},{"id":"tp_discover","type":"String","value":"0","chainId":"_all_"},{"id":"li_qa_new_cover","type":"String","value":"1","chainId":"_all_"},{"id":"li_hot_score_ab","type":"String","value":"0","chainId":"_all_"},{"id":"li_se_section","type":"String","value":"0","chainId":"_all_"},{"id":"tp_score_1","type":"String","value":"a","chainId":"_all_"},{"id":"soc_adreadfilter","type":"String","value":"0","chainId":"_all_"},{"id":"tsp_videobillboard","type":"String","value":"1","chainId":"_all_"},{"id":"li_salt_hot","type":"String","value":"1","chainId":"_all_"},{"id":"gue_thanks","type":"String","value":"0"},{"id":"tp_club_join","type":"String","value":"0","chainId":"_all_"},{"id":"soc_feed_intimacy","type":"String","value":"2","chainId":"_all_"},{"id":"li_hot_voted","type":"String","value":"0","chainId":"_all_"},{"id":"se_sug_entrance","type":"String","value":"1","chainId":"_all_"},{"id":"tp_sft","type":"String","value":"a","chainId":"_all_"},{"id":"soc_zcfw_broadcast","type":"String","value":"0","chainId":"_all_"},{"id":"qap_ques_invite","type":"String","value":"0","chainId":"_all_"},{"id":"zr_rec_answer_cp","type":"String","value":"close","chainId":"_all_"},{"id":"zr_slot_filter","type":"String","value":"false","chainId":"_all_"},{"id":"web_unfriendly_comm","type":"String","value":"0"},{"id":"se_auto_syn","type":"String","value":"0","chainId":"_all_"},{"id":"ug_follow_topic_1","type":"String","value":"2","chainId":"_all_"},{"id":"zr_slot_cold_start","type":"String","value":"aver","chainId":"_all_"},{"id":"se_adxtest","type":"String","value":"1","chainId":"_all_"},{"id":"tp_topic_tab_new","type":"String","value":"0-0-0","chainId":"_all_"},{"id":"se_search_feed","type":"String","value":"N","chainId":"_all_"},{"id":"zr_answer_rec_cp","type":"String","value":"open","chainId":"_all_"},{"id":"zr_test_aa1","type":"String","value":"0","chainId":"_all_"},{"id":"ls_fmp4","type":"String","value":"0","chainId":"_all_"},{"id":"li_answer_card","type":"String","value":"0","chainId":"_all_"},{"id":"se_famous","type":"String","value":"1","chainId":"_all_"},{"id":"soc_notification","type":"String","value":"0","chainId":"_all_"},{"id":"soc_authormore2","type":"String","value":"2","chainId":"_all_"},{"id":"se_ltr_cp_new","type":"String","value":"0","chainId":"_all_"},{"id":"se_use_zitem","type":"String","value":"0","chainId":"_all_"},{"id":"soc_iosintimacy","type":"String","value":"2","chainId":"_all_"},{"id":"pf_noti_entry_num","type":"String","value":"0","chainId":"_all_"},{"id":"sem_up_growth","type":"String","value":"in_app","chainId":"_all_"},{"id":"se_new_topic","type":"String","value":"0","chainId":"_all_"},{"id":"se_new_merger","type":"String","value":"1","chainId":"_all_"},{"id":"tp_meta_card","type":"String","value":"0","chainId":"_all_"},{"id":"soc_special","type":"String","value":"0","chainId":"_all_"},{"id":"tsp_hotlist_ui","type":"String","value":"1","chainId":"_all_"},{"id":"se_ctx_rerank","type":"String","value":"1","chainId":"_all_"},{"id":"web_mweb_rec_length","type":"String","value":"1"},{"id":"li_answer_label","type":"String","value":"0","chainId":"_all_"},{"id":"top_ebook","type":"String","value":"0","chainId":"_all_"},{"id":"se_cardrank_3","type":"String","value":"0","chainId":"_all_"},{"id":"ug_follow_answerer_0","type":"String","value":"0","chainId":"_all_"},{"id":"web_collect","type":"String","value":"0"},{"id":"zr_expslotpaid","type":"String","value":"1","chainId":"_all_"},{"id":"zr_intervene","type":"String","value":"0","chainId":"_all_"},{"id":"zr_slotpaidexp","type":"String","value":"1","chainId":"_all_"},{"id":"ug_fw_answ_aut_1","type":"String","value":"0","chainId":"_all_"},{"id":"ug_zero_follow","type":"String","value":"0","chainId":"_all_"},{"id":"li_svip_cardshow","type":"String","value":"0","chainId":"_all_"},{"id":"se_multianswer","type":"String","value":"0","chainId":"_all_"},{"id":"se_lottery","type":"String","value":"0","chainId":"_all_"},{"id":"se_cbert_ab","type":"String","value":"1","chainId":"_all_"},{"id":"tp_topic_tab","type":"String","value":"0","chainId":"_all_"},{"id":"tp_sft_v2","type":"String","value":"d","chainId":"_all_"},{"id":"se_cardrank_1","type":"String","value":"0","chainId":"_all_"},{"id":"tp_m_intro_re_topic","type":"String","value":"1","chainId":"_all_"},{"id":"li_vip_no_ad_mon","type":"String","value":"0","chainId":"_all_"},{"id":"qap_question_author","type":"String","value":"0","chainId":"_all_"},{"id":"zr_km_answer","type":"String","value":"open_cvr","chainId":"_all_"},{"id":"zr_km_slot_style","type":"String","value":"event_card","chainId":"_all_"},{"id":"zr_training_first","type":"String","value":"false","chainId":"_all_"},{"id":"se_webtimebox","type":"String","value":"0","chainId":"_all_"},{"id":"se_college_cm","type":"String","value":"0","chainId":"_all_"},{"id":"soc_yxzl_zcfw","type":"String","value":"0","chainId":"_all_"},{"id":"li_se_across","type":"String","value":"0","chainId":"_all_"},{"id":"li_sku_bottom_bar_re","type":"String","value":"0","chainId":"_all_"},{"id":"zr_training_queue","type":"String","value":"false","chainId":"_all_"},{"id":"zr_article_new","type":"String","value":"close","chainId":"_all_"},{"id":"se_col_boost","type":"String","value":"0","chainId":"_all_"},{"id":"se_zu_recommend","type":"String","value":"0","chainId":"_all_"},{"id":"pf_newguide_vertical","type":"String","value":"0","chainId":"_all_"},{"id":"se_topicfeed","type":"String","value":"0","chainId":"_all_"},{"id":"se_college","type":"String","value":"default","chainId":"_all_"},{"id":"se_prf","type":"String","value":"0","chainId":"_all_"},{"id":"se_agency","type":"String","value":" 0","chainId":"_all_"},{"id":"se_subtext","type":"String","value":"0","chainId":"_all_"},{"id":"tp_qa_metacard_top","type":"String","value":"top","chainId":"_all_"},{"id":"gue_anonymous","type":"String","value":"show"},{"id":"web_sec605","type":"String","value":"0"},{"id":"pf_foltopic_usernum","type":"String","value":"50","chainId":"_all_"},{"id":"ug_goodcomment_0","type":"String","value":"1","chainId":"_all_"},{"id":"web_n_web_msg","type":"String","value":"0"},{"id":"web_answerlist_ad","type":"String","value":"0"},{"id":"web_ask","type":"String","value":"0"},{"id":"zr_km_training_boost","type":"String","value":"false","chainId":"_all_"},{"id":"se_hotmore","type":"String","value":"2","chainId":"_all_"},{"id":"se_preset_label","type":"String","value":"1","chainId":"_all_"},{"id":"se_cardrank_4","type":"String","value":"1","chainId":"_all_"},{"id":"top_hotcommerce","type":"String","value":"1","chainId":"_all_"},{"id":"ls_zvideo_license","type":"String","value":"1","chainId":"_all_"},{"id":"li_album_liutongab","type":"String","value":"0","chainId":"_all_"},{"id":"gue_goods_card","type":"String","value":"0"},{"id":"zr_search_sim","type":"String","value":"0","chainId":"_all_"},{"id":"zr_km_style","type":"String","value":"base","chainId":"_all_"},{"id":"se_billboardsearch","type":"String","value":"0","chainId":"_all_"},{"id":"soc_zcfw_broadcast2","type":"String","value":"1","chainId":"_all_"},{"id":"se_hotsearch_2","type":"String","value":"1","chainId":"_all_"},{"id":"soc_zuichangfangwen","type":"String","value":"0","chainId":"_all_"},{"id":"tp_qa_toast","type":"String","value":"1","chainId":"_all_"},{"id":"tp_club_android_feed","type":"String","value":"old","chainId":"_all_"},{"id":"li_assessment_show","type":"String","value":"1","chainId":"_all_"},{"id":"li_answers_link","type":"String","value":"0","chainId":"_all_"},{"id":"web_answer_list_ad","type":"String","value":"1"},{"id":"zr_km_feed_nlp","type":"String","value":"old","chainId":"_all_"},{"id":"se_ltr_dnn_cp","type":"String","value":"0","chainId":"_all_"},{"id":"se_qanchor","type":"String","value":"0","chainId":"_all_"},{"id":"li_yxzl_new_style_a","type":"String","value":"1","chainId":"_all_"},{"id":"gue_zhuantikapian","type":"String","value":"0"},{"id":"qap_question_visitor","type":"String","value":" 0","chainId":"_all_"},{"id":"zr_video_rank","type":"String","value":"new_rank","chainId":"_all_"},{"id":"se_suggest_cache","type":"String","value":"0","chainId":"_all_"},{"id":"web_mweb_launch","type":"String","value":"0"},{"id":"se_club_post","type":"String","value":"5","chainId":"_all_"},{"id":"se_sug","type":"String","value":"1","chainId":"_all_"},{"id":"se_wannasearch","type":"String","value":"0","chainId":"_all_"},{"id":"tp_club_feed","type":"String","value":"1","chainId":"_all_"},{"id":"se_related_index","type":"String","value":"3","chainId":"_all_"},{"id":"se_featured","type":"String","value":"1","chainId":"_all_"},{"id":"li_android_vip","type":"String","value":"0","chainId":"_all_"},{"id":"li_education_box","type":"String","value":"0","chainId":"_all_"},{"id":"se_webmajorob","type":"String","value":"0","chainId":"_all_"},{"id":"soc_update","type":"String","value":"1","chainId":"_all_"},{"id":"soc_bigone","type":"String","value":"0","chainId":"_all_"},{"id":"ls_zvideo_rec","type":"String","value":"2","chainId":"_all_"}],"chains":[{"chainId":"_all_"}]},"triggers":{}},"userAgent":{"Edge":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"isWebView":false,"origin":"Mozilla\u002F5.0 (Windows NT 10.0; WOW64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F78.0.3904.108 Safari\u002F537.36"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F45673049","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F45673049","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false},"theme":"light","enableShortcut":true,"referer":"","conf":{},"ipInfo":{"cityName":"上海","countryName":"中国","regionName":"上海","countryCode":"CN"},"logged":false},"me":{"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"active":{"sendDigitsError":null,"activeConfirmSucceeded":null,"activeConfirmError":null},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false,"captchaBase64String":null,"captchaValidationMessage":null,"loginCaptchaExpires":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"currentCreatorUrlToken":null,"homeData":{"recommendQuestions":[]},"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0},"goodatTopics":[]},"customPromotion":{"itemLists":{}},"recommend":{"recommendTimes":{}}},"explore":{"academy":{"tabs":[],"article":{}}},"rights":[],"rightsStatus":{},"levelUpperLimit":10,"account":{"growthLevel":{}},"mcn":{},"applyStatus":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotListCategories":[],"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[],"contributionInvitation":null},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[]}},"fetchHost":"www.zhihu.com","subAppName":"column"}</script><script src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/vendor.e9fe143ca13fe8780d0b.js"></script><script src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/column.app.283b151ea62cf488a35d.js"></script><script src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/hm.js" async=""></script><script src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/push.js" async=""></script><script src="./Unity实时阴影实现——Cascaded Shadow Mapping - 知乎_files/zap.js"></script><div><div style="display: none;">想来知乎工作？请发送邮件到 jobs@zhihu.com</div></div><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete10-0" id="Popover9-toggle" aria-haspopup="true" aria-owns="Popover9-content" class="Input" placeholder="选择语言" value=""><svg class="Zi Zi--Select" fill="#afbdcf" viewBox="0 0 24 24" width="24" height="24"><path d="M12 16.183l2.716-2.966a.757.757 0 0 1 1.064.001.738.738 0 0 1 0 1.052l-3.247 3.512a.758.758 0 0 1-1.064 0L8.22 14.27a.738.738 0 0 1 0-1.052.758.758 0 0 1 1.063 0L12 16.183zm0-9.365L9.284 9.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l3.248-3.512a.758.758 0 0 1 1.065 0L15.78 8.73a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063.001L12 6.818z" fill-rule="evenodd"></path></svg></label></div></div></div></div></div></body><style type="text/css" id="546775737813"></style></html>